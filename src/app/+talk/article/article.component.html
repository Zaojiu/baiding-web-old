<div class="main" #main *ngIf="talkInfo" (touchstart)="touchStart($event)" (touchmove)="touchMove($event)" #container>
  <header [ngClass]="{sticky: !isVideoCoverShown && !isOnScreen, 'mobile-landscape': !isOnScreen && isLandscape}">
    <video-player
      class="video-player"
      [videoInfo]="videoInfo"
      [option]="videoOption"
      (onEvents)="onVideoEvent($event)"
      #videoPlayer
    ></video-player>

    <div class="download-tips" *ngIf="isDownloadTipsShow">
      <i class="bi bi-close" (click)="isDownloadTipsShow = false"></i>
      <div class="tips">
        造就iOS版
        <small>_REPL_SLOGAN_</small>
      </div>
      <a class="download-btn" (click)="isiOS ? redirectToYingYongBao() : showDownloadModal()">立即下载</a>
    </div>

    <div class="live-cover" *ngIf="isVideoCoverShown">
      <img
        class="cover-image"
        [src]="talkInfo.coverSmall11Url" alt="文章封面"
        (error)="resetDefaultBackground()"
      >

      <div class="mask"></div>

      <i class="bi bi-play-fill" *ngIf="videoInfo && videoInfo.hasVideo"></i>

      <div class="talk-info">
        <div class="publisher-info">
          <img class="avatar avatar-round avatar-md" *ngIf="talkInfo.userInfo" [src]="talkInfo.userInfo.avatar" alt="发布人头像">
          <span class="nick" *ngIf="talkInfo.userInfo">{{talkInfo.userInfo.nick}}</span>
        </div>

        <time>{{talkInfo.publishAt.format('YYYY年MM月DD日')}}</time>
      </div>

      <h1>{{talkInfo.subject}}</h1>
    </div>
  </header>

  <section class="article talk-article" [ngClass]="{hidden: !isOnScreen && isLandscape}" [innerHtml]="talkInfo.safeContent"></section>

  <section class="info" *ngIf="talkInfo.categories.length || talkInfo.tags.length" [ngClass]="{hidden: !isOnScreen && isLandscape}">
    <ul *ngFor="let catalogArr of talkInfo.categories">
      <li *ngFor="let catalog of catalogArr">{{catalog.title}}</li>
    </ul>

    <div class="tags">
      <small *ngFor="let tag of talkInfo.tags">{{tag}}</small>
    </div>
  </section>

  <section class="relatives" *ngIf="liveObject" [ngClass]="{hidden: !isOnScreen && isLandscape}">
    <h2>查看完整内容</h2>
    <div class="card" (click)="gotoLive(liveObject.id)">
      <img class="cover" [src]="liveObject.coverSmallUrl" alt="直播封面" (error)="coverLoadError(liveObject)">
      <div class="content">
        <h3>{{liveObject.subject}}</h3>
        <p>{{liveObject.desc}}</p>
      </div>
    </div>
  </section>

  <section class="comments" [ngClass]="{hidden: !isOnScreen && isLandscape}">
    <h2 #commentTitle>评论</h2>

    <div class="comment" *ngFor="let comment of comments">
      <div class="header">
        <div class="author-info">
          <img class="avatar avatar-round avatar-sm" [src]="comment.user.avatar" alt="用户头像">
          <span class="nick">{{comment.user.nick}}</span>
          <time>{{comment.createdAt.format('YYYY年MM月DD日 HH:mm')}}</time>
        </div>
        <span class="reply" (click)="gotoComment(comment.id, comment.user.nick, comment.content)">回复</span>
      </div>
      <div class="content"><div class="quote" *ngIf="comment.parent"><span class="nick">{{comment.parent.user.nick}}:</span>{{comment.parent.content}}</div>{{comment.content}}</div>
    </div>

    <bd-loading class="comment-loading" *ngIf="isCommentLoading"></bd-loading>

    <div class="no-comments" *ngIf="!isCommentLoading && !comments.length">暂无评论</div>
    <div class="more-comments" *ngIf="!isCommentLoading && hasMoreComments" (click)="listComments(comments[comments.length-1].originCreatedAt)">加载更多评论</div>
    <div class="no-more-comments" *ngIf="!isCommentLoading && comments.length && !hasMoreComments">到底咯~</div>
  </section>

  <footer *ngIf="talkInfo" [ngClass]="{hidden: !isOnScreen && isLandscape}" #toolBar>
    <div class="icon view">{{talkInfo.totalUsers}}人看过</div>
    <div class="icon" [ngClass]="{'activate': talkInfo.isPraised}" (click)="talkInfo.isPraised ? unpraise() : praise()"><i class="bi bi-thumbsup"></i>{{talkInfo.praiseTotal}}</div>
    <div class="icon" [ngClass]="{'activate': talkInfo.isFavorited}" (click)="talkInfo.isFavorited ? unfavorite() : favorite()"><i class="bi bi-favorite"></i></div>
    <div class="icon" (click)="gotoComment()"><i class="bi bi-comment"></i>{{talkInfo.commentTotal}}</div>
  </footer>
</div>

<div class="no-content" *ngIf="!talkInfo">无效内容</div>

<router-outlet></router-outlet>
