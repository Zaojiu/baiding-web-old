<div class="buy">
  <bd-loading class="abs-center" *ngIf="isLoading"></bd-loading>

  <div class="error-screen abs-center" *ngIf="!isLoading && !event">
    网络错误，请<a href="" (click)="initData(); $event.preventDefault();">重试</a>
  </div>

  <div class="container" *ngIf="!isLoading && event">
    <img class="cover" [src]="event.coverUrl" alt="头图">
    <div class="block">
      <h1 class="subject">{{event.subject}}</h1>
      <div class="desc talk-article" [innerHTML]="event.desc"></div>
    </div>
    <div class="speaker block" *ngFor="let speaker of event.meta.speakers">
      <img class="avatar avatar-round" [src]="speaker.coverUrl" alt="嘉宾头像">
      <h2 class="nick">{{speaker.name}}</h2>
      <div class="title" [innerHTML]="speaker.title"></div>
      <div class="desc" [innerHTML]="speaker.desc"></div>
    </div>
    <div class="location block" *ngIf="event.meta.startAt || event.meta.address">
      <p *ngIf="event.meta.startAt">
        时间：<span>{{event.meta.startAtParsed.format('YYYY-MM-DD HH:mm:ss')}}</span><span *ngIf="event.meta.endAt"> - {{event.meta.endAtParsed.format('YYYY-MM-DD HH:mm:ss').replace(event.meta.startAtParsed.format('YYYY-MM-DD'), '')}}</span>
      </p>
      <p class="address" *ngIf="event.meta.address">
        地点：<span *ngIf="event.meta.city">{{event.meta.city}} </span>{{event.meta.address}}
      </p>
    </div>
  </div>

  <footer *ngIf="!isLoading && event">
    <button class="button button-primary" (click)="buy()">{{btnText}}</button>
  </footer>

  <div class="goto-wechat-popup" (click)="isGotoWechatPopup = false" [ngClass]="{'show': isGotoWechatPopup, 'hide': !isGotoWechatPopup}">
    <div class="content" (click)="$event.stopPropagation()">
      <img *ngIf="qrcode" class="qrcode" [src]="qrcode" alt="二维码">
      <div class="tips">使用微信扫码购票</div>
    </div>
  </div>

  <div class="payment-popup" *ngIf="!isLoading && event" [ngClass]="{'show': isPaymentPopup}">
    <div class="header">
      <div class="subject">{{event.subject}}</div>
      <i class="bi bi-close" (click)="isPaymentPopup = false" *ngIf="isNewPayment"></i>
    </div>
    <div class="detail">
      <div class="item-name">门票</div>
      <div class="item-count">
        <div class="adjuster">
          <span class="increase" *ngIf="isNewPayment" (click)="ticketCount=ticketCount+1"></span><input [disabled]="!isNewPayment" class="count-input" type="number" [(ngModel)]="ticketCount"><span class="decrease" *ngIf="isNewPayment" (click)="ticketCount > 1 ? ticketCount=ticketCount-1 : true"></span>
        </div>
        <p class="error" *ngIf="isTicketCountError">输入数量错误，请输入大于0的整数</p>
      </div>
    </div>
    <div class="amount">
      <bd-loading *ngIf="isAmoutLoading"></bd-loading>
      <span *ngIf="!isAmoutLoading">{{amount.toYuan()}}</span>
    </div>
    <button class="button button-primary">微信支付</button>
  </div>

  <div class="continue-popup" *ngIf="!isLoading && event" [ngClass]="{'show': isContinuePopup}">
    <div class="tips">你已{{oldTicket ? oldTicket.amount : '￥0.00'}}订购本次活动门票，正在等待付款</div>
    <button class="button button-primary" (click)="popupPayment(false)">继续支付</button>
    <button class="button button-outline" (click)="popupPayment(true); clearOldTicket()">重新购买</button>
  </div>
</div>

