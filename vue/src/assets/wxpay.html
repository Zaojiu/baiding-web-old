<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>微信支付</title>
</head>
<body>
  <script>
    var req = location.search.split('&')[0].split('=')[1];
    var backto = decodeURIComponent(location.search.split('&')[1].split('=')[1]);
    wxPayReq = JSON.parse(decodeURIComponent(req));

    function onBridgeReady(){
      WeixinJSBridge.invoke(
        'getBrandWCPayRequest', {
          "appId": wxPayReq.appId,     //公众号名称，由商户传入
          "timeStamp": wxPayReq.timeStamp,         //时间戳，自1970年以来的秒数
          "nonceStr": wxPayReq.nonceStr, //随机串
          "package": wxPayReq.package,
          "signType": wxPayReq.signType,         //微信签名方式：
          "paySign": wxPayReq.paySign //微信签名
        },
        function(res){
          if(res.err_msg == "get_brand_wcpay_request:ok" ) {
            location.href = `${backto};payResult=success`;
          } else {
            location.href = `${backto};payResult=fail`;
          }

          return;
        }
      );
    }

    if (typeof WeixinJSBridge == "undefined"){
      if( document.addEventListener ){
        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
      }else if (document.attachEvent){
        document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
      }
    }else{
      onBridgeReady();
    }
  </script>
</body>
</html>
